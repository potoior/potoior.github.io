<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>代码神域：第20章：Tomcat服务器：Web应用的运行容器 | potoior</title><meta name="author" content="potoior"><meta name="copyright" content="potoior"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="第20章：Tomcat服务器：Web应用的运行容器">
<meta property="og:type" content="article">
<meta property="og:title" content="代码神域：第20章：Tomcat服务器：Web应用的运行容器">
<meta property="og:url" content="http://example.com/2025/10/01/%E7%AC%AC20%E7%AB%A0%EF%BC%9ATomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9AWeb%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8/index.html">
<meta property="og:site_name" content="potoior">
<meta property="og:description" content="第20章：Tomcat服务器：Web应用的运行容器">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-10-01T01:09:04.675Z">
<meta property="article:modified_time" content="2025-10-01T00:47:41.000Z">
<meta property="article:author" content="potoior">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "代码神域：第20章：Tomcat服务器：Web应用的运行容器",
  "url": "http://example.com/2025/10/01/%E7%AC%AC20%E7%AB%A0%EF%BC%9ATomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9AWeb%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8/",
  "image": "http://example.com/img/butterfly-icon.png",
  "datePublished": "2025-10-01T01:09:04.675Z",
  "dateModified": "2025-10-01T00:47:41.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "potoior",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/10/01/%E7%AC%AC20%E7%AB%A0%EF%BC%9ATomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9AWeb%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 18
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '代码神域：第20章：Tomcat服务器：Web应用的运行容器',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div id="web_bg" style="background-image: url(/img/bg.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post type-代码神域" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">potoior</span></a><a class="nav-page-title" href="/"><span class="site-name">代码神域：第20章：Tomcat服务器：Web应用的运行容器</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">代码神域：第20章：Tomcat服务器：Web应用的运行容器</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-01T01:09:04.675Z" title="发表于 2025-10-01 09:09:04">2025-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-01T00:47:41.000Z" title="更新于 2025-10-01 08:47:41">2025-10-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BB%A3%E7%A0%81%E7%A5%9E%E5%9F%9F/">代码神域</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">8.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-10-01 08:47:41&quot;}" hidden></div><h1><span id="第20章tomcat服务器web应用的运行容器">第20章：Tomcat服务器：Web应用的运行容器</span></h1><h2><span id="章节概述">章节概述</span></h2><p><strong>字数统计</strong>：14,500字<br><strong>核心场景</strong>：服务器控制室、容器引擎舱、部署流水线<br><strong>技术冲突</strong>：部署失败、性能瓶颈、配置复杂<br><strong>成长主题</strong>：从本地开发到生产部署的完整流程掌握</p>
<hr>
<h2><span id="开篇部署的挑战">开篇：部署的挑战</span></h2><p>张子烨和小温成功优化了HTTP协议性能，员工管理系统的API响应时间大幅提升。然而，当他们准备将系统部署到生产环境时，遇到了新的挑战。</p>
<p>“子烨，你看这个部署日志，”小温指着服务器控制台的错误信息，”Tomcat启动失败，提示端口被占用。”</p>
<p>张子烨检查配置文件：”8080端口确实被占用了。我们需要重新配置Tomcat，或者使用其他端口。”</p>
<p>就在这时，代码神域的服务器控制室缓缓打开，小wic的声音在耳边响起：”年轻的程序员们，你们已经掌握了HTTP协议这个Web世界的通用语言。现在，让我们进入Tomcat服务器的世界，学习如何让Web应用在生产环境中稳定运行。”</p>
<hr>
<h2><span id="1-tomcat基础web应用的容器引擎">1. Tomcat基础：Web应用的容器引擎</span></h2><h3><span id="11-什么是tomcat">1.1 什么是Tomcat？</span></h3><p>在代码神域的服务器控制室中，小wic带着张子烨和小温来到一面巨大的容器引擎墙前。墙上展示着Tomcat服务器的完整架构。</p>
<p>“Tomcat，全称Apache Tomcat，是Java Web应用的标准容器，”小wic指着墙上的架构图解释，”它实现了Java Servlet和JSP规范，为Web应用提供运行环境。”</p>
<p><strong>Tomcat的核心组件</strong>：</p>
<ul>
<li><strong>Server</strong>：整个Tomcat实例</li>
<li><strong>Service</strong>：服务组件集合</li>
<li><strong>Connector</strong>：连接器，处理HTTP请求</li>
<li><strong>Engine</strong>：引擎，处理请求的核心</li>
<li><strong>Host</strong>：虚拟主机，支持多域名</li>
<li><strong>Context</strong>：Web应用上下文</li>
</ul>
<h3><span id="12-tomcat目录结构">1.2 Tomcat目录结构</span></h3><p>小wic开始讲解Tomcat的目录结构：”理解目录结构是掌握Tomcat的第一步。”</p>
<p><strong>核心目录说明</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tomcat/</span><br><span class="line">├── bin/           # 启动脚本和可执行文件</span><br><span class="line">│   ├── startup.sh    # Linux启动脚本</span><br><span class="line">│   ├── shutdown.sh   # Linux停止脚本</span><br><span class="line">│   ├── startup.bat   # Windows启动脚本</span><br><span class="line">│   └── shutdown.bat  # Windows停止脚本</span><br><span class="line">├── conf/          # 配置文件目录</span><br><span class="line">│   ├── server.xml    # 主配置文件</span><br><span class="line">│   ├── web.xml       # 全局Web应用配置</span><br><span class="line">│   └── context.xml   # 上下文配置</span><br><span class="line">├── lib/           # 共享库文件</span><br><span class="line">├── logs/          # 日志文件目录</span><br><span class="line">├── temp/          # 临时文件目录</span><br><span class="line">├── webapps/       # Web应用部署目录</span><br><span class="line">│   ├── ROOT/          # 根应用</span><br><span class="line">│   ├── manager/       # 管理应用</span><br><span class="line">│   └── your-app/      # 你的应用</span><br><span class="line">└── work/          # 工作目录（JSP编译文件）</span><br></pre></td></tr></table></figure>

<p>张子烨仔细观察着目录结构：”原来Tomcat有这么多目录，每个都有特定的用途。webapps目录就是部署我们应用的地方。”</p>
<h3><span id="13-tomcat启动流程">1.3 Tomcat启动流程</span></h3><p>小wic演示Tomcat的启动过程：”Tomcat启动时遵循特定的流程。”</p>
<p><strong>启动步骤详解</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 加载配置文件</span></span><br><span class="line"><span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServer</span>();</span><br><span class="line">server.init();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 初始化服务</span></span><br><span class="line"><span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardService</span>();</span><br><span class="line">service.setName(<span class="string">&quot;Catalina&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建连接器</span></span><br><span class="line"><span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>(<span class="string">&quot;HTTP/1.1&quot;</span>);</span><br><span class="line">connector.setPort(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 创建引擎</span></span><br><span class="line"><span class="type">Engine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEngine</span>();</span><br><span class="line">engine.setName(<span class="string">&quot;Catalina&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 创建主机</span></span><br><span class="line"><span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardHost</span>();</span><br><span class="line">host.setName(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 启动服务</span></span><br><span class="line">service.start();</span><br><span class="line">server.start();</span><br></pre></td></tr></table></figure>

<p><strong>启动脚本分析</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># startup.sh - Tomcat启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="built_in">export</span> CATALINA_HOME=/opt/tomcat</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-11-openjdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Tomcat</span></span><br><span class="line"><span class="variable">$CATALINA_HOME</span>/bin/catalina.sh start</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="2-配置文件详解tomcat的核心设置">2. 配置文件详解：Tomcat的核心设置</span></h2><h3><span id="21-serverxml配置">2.1 server.xml配置</span></h3><p>小wic开始讲解server.xml配置文件：”这是Tomcat的主配置文件，控制着服务器的核心行为。”</p>
<p><strong>基础server.xml配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">&quot;8005&quot;</span> <span class="attr">shutdown</span>=<span class="string">&quot;SHUTDOWN&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 全局命名资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;UserDatabase&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">type</span>=<span class="string">&quot;org.apache.catalina.UserDatabase&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">description</span>=<span class="string">&quot;User database&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">factory</span>=<span class="string">&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">pathname</span>=<span class="string">&quot;conf/tomcat-users.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 服务配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- HTTP连接器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">maxThreads</span>=<span class="string">&quot;200&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">minSpareThreads</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">maxConnections</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">acceptCount</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- AJP连接器（可选） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8009&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 引擎配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span> <span class="attr">defaultHost</span>=<span class="string">&quot;localhost&quot;</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 虚拟主机配置 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;localhost&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 上下文配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;/employee&quot;</span> </span></span><br><span class="line"><span class="tag">                         <span class="attr">docBase</span>=<span class="string">&quot;employee-management&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">crossContext</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">&lt;!-- 数据源配置 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;jdbc/EmployeeDB&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">type</span>=<span class="string">&quot;javax.sql.DataSource&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">maxTotal</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">maxIdle</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">maxWaitMillis</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">username</span>=<span class="string">&quot;employee_user&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">password</span>=<span class="string">&quot;secure_password&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">driverClassName</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/employee_db&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 访问日志阀门 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> </span></span><br><span class="line"><span class="tag">                       <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log&quot;</span> </span></span><br><span class="line"><span class="tag">                       <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">pattern</span>=<span class="string">&quot;%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>关键配置参数说明</strong>：</p>
<ul>
<li><strong>port</strong>：服务器监听端口</li>
<li><strong>maxThreads</strong>：最大线程数，影响并发处理能力</li>
<li><strong>connectionTimeout</strong>：连接超时时间</li>
<li><strong>acceptCount</strong>：等待队列长度</li>
<li><strong>autoDeploy</strong>：是否自动部署应用</li>
</ul>
<h3><span id="22-webxml配置">2.2 web.xml配置</span></h3><p>小wic讲解web.xml的作用：”这是Web应用的部署描述符，定义了Servlet、过滤器等组件。”</p>
<p><strong>全局web.xml配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee </span></span></span><br><span class="line"><span class="string"><span class="tag">                             http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 默认Servlet配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- JSP Servlet配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.jasper.servlet.JspServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>fork<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>xpoweredBy<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>3<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 会话配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>30<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cookie-config</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">http-only</span>&gt;</span>true<span class="tag">&lt;/<span class="name">http-only</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">secure</span>&gt;</span>true<span class="tag">&lt;/<span class="name">secure</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">cookie-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tracking-mode</span>&gt;</span>COOKIE<span class="tag">&lt;/<span class="name">tracking-mode</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- MIME类型映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span>json<span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mime-type</span>&gt;</span>application/json<span class="tag">&lt;/<span class="name">mime-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mime-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 欢迎文件列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 错误页面配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error/500.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="23-contextxml配置">2.3 context.xml配置</span></h3><p>小wic讲解上下文配置的重要性：”context.xml定义了Web应用的运行环境。”</p>
<p><strong>应用级context.xml配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 数据源配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;jdbc/EmployeeDB&quot;</span> </span></span><br><span class="line"><span class="tag">              <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;javax.sql.DataSource&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">factory</span>=<span class="string">&quot;org.apache.tomcat.jdbc.pool.DataSourceFactory&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">driverClassName</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/employee_db?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">username</span>=<span class="string">&quot;employee_user&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">password</span>=<span class="string">&quot;secure_password&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">maxTotal</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">maxIdle</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">maxWaitMillis</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">testOnBorrow</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">validationQuery</span>=<span class="string">&quot;SELECT 1&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">removeAbandonedTimeout</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">removeAbandonedOnBorrow</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">removeAbandonedOnMaintenance</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">logAbandoned</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 会话管理器配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.PersistentManager&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">saveOnRestart</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Store</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.FileStore&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">directory</span>=<span class="string">&quot;$&#123;catalina.base&#125;/work/Sessions&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Manager</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 环境变量配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Environment</span> <span class="attr">name</span>=<span class="string">&quot;app.env&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">value</span>=<span class="string">&quot;production&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">override</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 参数配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Parameter</span> <span class="attr">name</span>=<span class="string">&quot;upload.maxSize&quot;</span> </span></span><br><span class="line"><span class="tag">               <span class="attr">value</span>=<span class="string">&quot;10485760&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">override</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="3-部署方式web应用的发布策略">3. 部署方式：Web应用的发布策略</span></h2><h3><span id="31-自动部署">3.1 自动部署</span></h3><p>小wic讲解Tomcat的自动部署机制：”Tomcat支持多种部署方式，自动部署是最简单的一种。”</p>
<p><strong>自动部署流程</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 将WAR文件复制到webapps目录</span></span><br><span class="line"><span class="built_in">cp</span> employee-management.war <span class="variable">$CATALINA_HOME</span>/webapps/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Tomcat自动检测并部署</span></span><br><span class="line"><span class="comment"># 应用将自动解压到employee-management目录</span></span><br><span class="line"><span class="comment"># 可以通过 http://localhost:8080/employee-management 访问</span></span><br></pre></td></tr></table></figure>

<p><strong>部署监控脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># deploy-monitor.sh - 部署监控脚本</span></span><br><span class="line"></span><br><span class="line">APP_NAME=<span class="string">&quot;employee-management&quot;</span></span><br><span class="line">WAR_FILE=<span class="string">&quot;<span class="variable">$APP_NAME</span>.war&quot;</span></span><br><span class="line">DEPLOY_DIR=<span class="string">&quot;/opt/tomcat/webapps&quot;</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;/var/log/tomcat/deploy.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查WAR文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$WAR_FILE</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: WAR文件不存在: <span class="variable">$WAR_FILE</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份原有应用</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$DEPLOY_DIR</span>/<span class="variable">$APP_NAME</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    BACKUP_DIR=<span class="string">&quot;/backup/<span class="subst">$(date +%Y%m%d_%H%M%S)</span>_<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line">    <span class="built_in">cp</span> -r <span class="string">&quot;<span class="variable">$DEPLOY_DIR</span>/<span class="variable">$APP_NAME</span>&quot;</span> <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 应用备份完成: <span class="variable">$BACKUP_DIR</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止Tomcat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 停止Tomcat...&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">/opt/tomcat/bin/shutdown.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待Tomcat完全停止</span></span><br><span class="line"><span class="built_in">sleep</span> 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理工作目录</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$DEPLOY_DIR</span>/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;/opt/tomcat/work/Catalina/localhost/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署新应用</span></span><br><span class="line"><span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$WAR_FILE</span>&quot;</span> <span class="string">&quot;<span class="variable">$DEPLOY_DIR</span>/&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 新应用部署完成&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Tomcat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 启动Tomcat...&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">/opt/tomcat/bin/startup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查部署状态</span></span><br><span class="line"><span class="built_in">sleep</span> 30</span><br><span class="line"><span class="keyword">if</span> curl -s http://localhost:8080/<span class="variable">$APP_NAME</span>/health &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 部署成功&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: 部署失败&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$LOG_FILE</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3><span id="32-手动部署">3.2 手动部署</span></h3><p>小wic讲解手动部署的优势：”手动部署提供更精细的控制。”</p>
<p><strong>手动部署配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在server.xml中手动配置Context --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;/employee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">docBase</span>=<span class="string">&quot;/opt/apps/employee-management&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">reloadable</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">crossContext</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 环境配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Environment</span> <span class="attr">name</span>=<span class="string">&quot;db.url&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://prod-db:3306/employee&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 资源引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ResourceLink</span> <span class="attr">name</span>=<span class="string">&quot;jdbc/EmployeeDB&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">global</span>=<span class="string">&quot;jdbc/EmployeeDB&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">type</span>=<span class="string">&quot;javax.sql.DataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>部署验证脚本</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeploymentValidator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">validateDeployment</span><span class="params">(String appUrl)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 检查应用是否可访问</span></span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(appUrl + <span class="string">&quot;/health&quot;</span>);</span><br><span class="line">            <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">            connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">            connection.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">            connection.setReadTimeout(<span class="number">5000</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> <span class="variable">responseCode</span> <span class="operator">=</span> connection.getResponseCode();</span><br><span class="line">            <span class="keyword">return</span> responseCode == <span class="number">200</span>;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;部署验证失败: &quot;</span> + e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">checkResources</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 检查数据库连接</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DataSourceUtils.getConnection(dataSource)) &#123;</span><br><span class="line">            <span class="type">DatabaseMetaData</span> <span class="variable">metaData</span> <span class="operator">=</span> conn.getMetaData();</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库连接正常: &quot;</span> + metaData.getDatabaseProductName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;数据库连接失败: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查文件系统权限</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">appDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/opt/apps/employee-management&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!appDir.canRead() || !appDir.canExecute()) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;应用目录权限不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="33-热部署与热加载">3.3 热部署与热加载</span></h3><p>小wic讲解热部署机制：”热部署可以在不重启Tomcat的情况下更新应用。”</p>
<p><strong>热部署配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 启用热部署 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;/employee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">docBase</span>=<span class="string">&quot;employee-management&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">antiResourceLocking</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">antiJARLocking</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>热部署监控</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HotDeployMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HotDeployMonitor.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ContextRefreshedEvent event)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;应用上下文刷新完成&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查资源加载状态</span></span><br><span class="line">        checkDataSource();</span><br><span class="line">        checkCache();</span><br><span class="line">        checkExternalServices();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> ApplicationContextHolder.getBean(DataSource.class);</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">            conn.close();</span><br><span class="line">            logger.info(<span class="string">&quot;数据源连接正常&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;数据源连接异常&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 检查缓存服务</span></span><br><span class="line">        <span class="type">CacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> ApplicationContextHolder.getBean(CacheManager.class);</span><br><span class="line">        <span class="keyword">if</span> (cacheManager != <span class="literal">null</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;缓存服务正常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkExternalServices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 检查外部服务连接</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="4-性能优化tomcat的高效运行">4. 性能优化：Tomcat的高效运行</span></h2><h3><span id="41-连接器优化">4.1 连接器优化</span></h3><p>小wic开始讲解连接器优化：”连接器配置直接影响Tomcat的并发处理能力。”</p>
<p><strong>高性能连接器配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11Nio2Protocol&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxThreads</span>=<span class="string">&quot;500&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">minSpareThreads</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxConnections</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">acceptCount</span>=<span class="string">&quot;200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">compression</span>=<span class="string">&quot;on&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">compressionMinSize</span>=<span class="string">&quot;2048&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">compressableMimeType</span>=<span class="string">&quot;text/html,text/xml,text/plain,text/css,text/javascript,application/json&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">enableLookups</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">server</span>=<span class="string">&quot;Apache Tomcat/9.0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxHttpHeaderSize</span>=<span class="string">&quot;8192&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">tcpNoDelay</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionLinger</span>=<span class="string">&quot;-1&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- SSL配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Certificate</span> <span class="attr">certificateKeystoreFile</span>=<span class="string">&quot;conf/keystore.jks&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">certificateKeystorePassword</span>=<span class="string">&quot;changeit&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">&quot;RSA&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Connector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>关键参数优化说明</strong>：</p>
<ul>
<li><strong>maxThreads&#x3D;500</strong>：增加线程数提升并发能力</li>
<li><strong>minSpareThreads&#x3D;50</strong>：保持最小空闲线程减少创建开销</li>
<li><strong>acceptCount&#x3D;200</strong>：增大等待队列长度</li>
<li><strong>compression&#x3D;on</strong>：启用响应压缩减少网络传输</li>
<li><strong>enableLookups&#x3D;false</strong>：禁用DNS查询提升性能</li>
</ul>
<h3><span id="42-jvm参数优化">4.2 JVM参数优化</span></h3><p>小wic讲解JVM参数优化的重要性：”合理的JVM配置可以显著提升Tomcat性能。”</p>
<p><strong>JVM优化配置</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setenv.sh - JVM参数配置</span></span><br><span class="line"><span class="built_in">export</span> JAVA_OPTS=<span class="string">&quot;-server -Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -XX:InitiatingHeapOccupancyPercent=35 -XX:+DisableExplicitGC -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/opt/tomcat/logs/heapdump.hprof -Xloggc:/opt/tomcat/logs/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>JVM参数详解</strong>：</p>
<ul>
<li><strong>-Xms2g -Xmx2g</strong>：设置堆内存大小，避免动态调整</li>
<li><strong>-XX:+UseG1GC</strong>：使用G1垃圾收集器</li>
<li><strong>-XX:MaxGCPauseMillis&#x3D;200</strong>：控制GC停顿时间</li>
<li><strong>-XX:+HeapDumpOnOutOfMemoryError</strong>：内存溢出时生成堆转储</li>
<li><strong>-Xloggc</strong>：GC日志输出路径</li>
</ul>
<h3><span id="43-会话管理优化">4.3 会话管理优化</span></h3><p>小wic讲解会话优化策略：”会话管理对Web应用性能影响很大。”</p>
<p><strong>会话配置优化</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 会话管理器配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.PersistentManager&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">saveOnRestart</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxActiveSessions</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">minIdleSwap</span>=<span class="string">&quot;300&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxIdleSwap</span>=<span class="string">&quot;600&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxIdleBackup</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 会话存储配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Store</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.FileStore&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">directory</span>=<span class="string">&quot;$&#123;catalina.base&#125;/work/Sessions&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Manager</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>会话优化策略</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletContextInitializer <span class="title function_">servletContextInitializer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> servletContext -&gt; &#123;</span><br><span class="line">            <span class="comment">// 配置会话超时时间</span></span><br><span class="line">            servletContext.setSessionTimeout(<span class="number">30</span>); <span class="comment">// 30分钟</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 配置会话Cookie</span></span><br><span class="line">            <span class="type">SessionCookieConfig</span> <span class="variable">sessionCookieConfig</span> <span class="operator">=</span> servletContext.getSessionCookieConfig();</span><br><span class="line">            sessionCookieConfig.setHttpOnly(<span class="literal">true</span>);</span><br><span class="line">            sessionCookieConfig.setSecure(<span class="literal">true</span>);</span><br><span class="line">            sessionCookieConfig.setMaxAge(<span class="number">1800</span>); <span class="comment">// 30分钟</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HttpSessionIdResolver <span class="title function_">httpSessionIdResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 使用Cookie作为会话ID解析器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CookieHttpSessionIdResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 会话监听器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionListener</span> <span class="keyword">implements</span> <span class="title class_">HttpSessionListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SessionListener.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sessionCreated</span><span class="params">(HttpSessionEvent se)</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> se.getSession();</span><br><span class="line">        logger.info(<span class="string">&quot;会话创建: &#123;&#125;&quot;</span>, session.getId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置会话属性</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;creationTime&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        session.setAttribute(<span class="string">&quot;lastAccessTime&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sessionDestroyed</span><span class="params">(HttpSessionEvent se)</span> &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> se.getSession();</span><br><span class="line">        logger.info(<span class="string">&quot;会话销毁: &#123;&#125;&quot;</span>, session.getId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清理会话资源</span></span><br><span class="line">        session.removeAttribute(<span class="string">&quot;userData&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="5-安全管理tomcat的安全防护">5. 安全管理：Tomcat的安全防护</span></h2><h3><span id="51-用户认证与授权">5.1 用户认证与授权</span></h3><p>小wic讲解Tomcat的安全机制：”用户认证是Web应用安全的基础。”</p>
<p><strong>用户配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- tomcat-users.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 角色定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-script&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-jmx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-status&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-script&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 用户定义 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;admin&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">password</span>=<span class="string">&quot;$2a$10$N9qo8uLOickgx2ZMRZoMye&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">roles</span>=<span class="string">&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;deployer&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">password</span>=<span class="string">&quot;$2a$10$N9qo8uLOickgx2ZMRZoMye&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">roles</span>=<span class="string">&quot;manager-script&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;monitor&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">password</span>=<span class="string">&quot;$2a$10$N9qo8uLOickgx2ZMRZoMye&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">roles</span>=<span class="string">&quot;manager-status&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>安全约束配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml中的安全约束 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">security-constraint</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">web-resource-collection</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">web-resource-name</span>&gt;</span>Protected Area<span class="tag">&lt;/<span class="name">web-resource-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/admin/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">http-method</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">http-method</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">web-resource-collection</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">auth-constraint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">role-name</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">role-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">auth-constraint</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">user-data-constraint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transport-guarantee</span>&gt;</span>CONFIDENTIAL<span class="tag">&lt;/<span class="name">transport-guarantee</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">user-data-constraint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">security-constraint</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">login-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">auth-method</span>&gt;</span>FORM<span class="tag">&lt;/<span class="name">auth-method</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">realm-name</span>&gt;</span>Employee Management Realm<span class="tag">&lt;/<span class="name">realm-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form-login-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form-login-page</span>&gt;</span>/login.html<span class="tag">&lt;/<span class="name">form-login-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form-error-page</span>&gt;</span>/error.html<span class="tag">&lt;/<span class="name">form-error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form-login-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">login-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="52-sslx2ftls配置">5.2 SSL&#x2F;TLS配置</span></h3><p>小wic讲解HTTPS配置：”SSL&#x2F;TLS加密保护数据传输安全。”</p>
<p><strong>SSL配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8443&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11Nio2Protocol&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxThreads</span>=<span class="string">&quot;150&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">SSLEnabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">scheme</span>=<span class="string">&quot;https&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">secure</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">clientAuth</span>=<span class="string">&quot;false&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">sslProtocol</span>=<span class="string">&quot;TLS&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">keystoreFile</span>=<span class="string">&quot;conf/keystore.jks&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">keystorePass</span>=<span class="string">&quot;changeit&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 密码套件配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Certificate</span> <span class="attr">certificateKeystoreFile</span>=<span class="string">&quot;conf/keystore.jks&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">certificateKeystorePassword</span>=<span class="string">&quot;changeit&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">certificateKeyAlias</span>=<span class="string">&quot;tomcat&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">&quot;RSA&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 现代密码套件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Cipher</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Cipher</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Connector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>证书生成脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># generate-ssl-cert.sh</span></span><br><span class="line"></span><br><span class="line">KEYSTORE_FILE=<span class="string">&quot;keystore.jks&quot;</span></span><br><span class="line">KEYSTORE_PASS=<span class="string">&quot;changeit&quot;</span></span><br><span class="line">ALIAS=<span class="string">&quot;tomcat&quot;</span></span><br><span class="line">VALIDITY_DAYS=<span class="string">&quot;365&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成密钥库</span></span><br><span class="line">keytool -genkeypair \</span><br><span class="line">    -<span class="built_in">alias</span> <span class="string">&quot;<span class="variable">$ALIAS</span>&quot;</span> \</span><br><span class="line">    -keyalg RSA \</span><br><span class="line">    -keysize 2048 \</span><br><span class="line">    -validity <span class="string">&quot;<span class="variable">$VALIDITY_DAYS</span>&quot;</span> \</span><br><span class="line">    -keystore <span class="string">&quot;<span class="variable">$KEYSTORE_FILE</span>&quot;</span> \</span><br><span class="line">    -storepass <span class="string">&quot;<span class="variable">$KEYSTORE_PASS</span>&quot;</span> \</span><br><span class="line">    -keypass <span class="string">&quot;<span class="variable">$KEYSTORE_PASS</span>&quot;</span> \</span><br><span class="line">    -dname <span class="string">&quot;CN=localhost, OU=IT, O=Company, L=City, ST=State, C=CN&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出证书</span></span><br><span class="line">keytool -exportcert \</span><br><span class="line">    -<span class="built_in">alias</span> <span class="string">&quot;<span class="variable">$ALIAS</span>&quot;</span> \</span><br><span class="line">    -file <span class="string">&quot;tomcat.cer&quot;</span> \</span><br><span class="line">    -keystore <span class="string">&quot;<span class="variable">$KEYSTORE_FILE</span>&quot;</span> \</span><br><span class="line">    -storepass <span class="string">&quot;<span class="variable">$KEYSTORE_PASS</span>&quot;</span> \</span><br><span class="line">    -rfc</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SSL证书生成完成&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;密钥库文件: <span class="variable">$KEYSTORE_FILE</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;证书文件: tomcat.cer&quot;</span></span><br></pre></td></tr></table></figure>

<h3><span id="53-安全头部配置">5.3 安全头部配置</span></h3><p>小wic讲解安全头部的重要性：”安全头部可以防止多种Web攻击。”</p>
<p><strong>安全过滤器配置</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityHeadersFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, </span></span><br><span class="line"><span class="params">                        FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置安全头部</span></span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;X-Content-Type-Options&quot;</span>, <span class="string">&quot;nosniff&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;X-Frame-Options&quot;</span>, <span class="string">&quot;DENY&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;X-XSS-Protection&quot;</span>, <span class="string">&quot;1; mode=block&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Strict-Transport-Security&quot;</span>, <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Referrer-Policy&quot;</span>, <span class="string">&quot;strict-origin-when-cross-origin&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Content-Security-Policy&quot;</span>, <span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="6-监控与日志tomcat的运行状态跟踪">6. 监控与日志：Tomcat的运行状态跟踪</span></h2><h3><span id="61-访问日志配置">6.1 访问日志配置</span></h3><p>小wic讲解访问日志的重要性：”访问日志记录所有HTTP请求，是问题排查的重要依据。”</p>
<p><strong>访问日志阀门配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">pattern</span>=<span class="string">&quot;%&#123;yyyy-MM-dd HH:mm:ss&#125;t %&#123;X-Forwarded-For&#125;i %l %u %r %s %b %D %&#123;User-Agent&#125;i %&#123;Referer&#125;i&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">rotatable</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">renameOnRotate</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">fileDateFormat</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">maxDays</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">conditionUnless</span>=<span class="string">&quot;health&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>日志格式说明</strong>：</p>
<ul>
<li><strong>%t</strong>：时间戳</li>
<li><strong>%{X-Forwarded-For}i</strong>：客户端真实IP</li>
<li><strong>%r</strong>：请求行</li>
<li><strong>%s</strong>：状态码</li>
<li><strong>%b</strong>：响应字节数</li>
<li><strong>%D</strong>：处理时间（毫秒）</li>
<li><strong>%{User-Agent}i</strong>：用户代理</li>
<li><strong>%{Referer}i</strong>：来源页面</li>
</ul>
<h3><span id="62-应用日志配置">6.2 应用日志配置</span></h3><p>小wic讲解应用日志配置：”合理的日志配置有助于问题定位。”</p>
<p><strong>Logback日志配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 文件输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/employee-management.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/employee-management.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 错误日志单独输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/error.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>90<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 日志级别配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.employee&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="63-jmx监控配置">6.3 JMX监控配置</span></h3><p>小wic讲解JMX监控：”JMX可以实时监控Tomcat的运行状态。”</p>
<p><strong>JMX配置</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setenv.sh中的JMX配置</span></span><br><span class="line"><span class="built_in">export</span> CATALINA_OPTS=<span class="string">&quot;<span class="variable">$CATALINA_OPTS</span> -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9090 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=localhost&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>监控脚本</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomcatMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> MBeanServer mBeanServer;</span><br><span class="line">    <span class="keyword">private</span> ObjectName connectorName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> MalformedObjectNameException &#123;</span><br><span class="line">        mBeanServer = ManagementFactory.getPlatformMBeanServer();</span><br><span class="line">        connectorName = <span class="keyword">new</span> <span class="title class_">ObjectName</span>(<span class="string">&quot;Catalina:type=ThreadPool,name=http-nio-8080&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TomcatStats <span class="title function_">getTomcatStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">TomcatStats</span> <span class="variable">stats</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TomcatStats</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取线程池信息</span></span><br><span class="line">            stats.setCurrentThreadCount((Integer) mBeanServer.getAttribute(connectorName, <span class="string">&quot;currentThreadCount&quot;</span>));</span><br><span class="line">            stats.setCurrentThreadsBusy((Integer) mBeanServer.getAttribute(connectorName, <span class="string">&quot;currentThreadsBusy&quot;</span>));</span><br><span class="line">            stats.setMaxThreads((Integer) mBeanServer.getAttribute(connectorName, <span class="string">&quot;maxThreads&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 获取请求统计</span></span><br><span class="line">            stats.setRequestCount((Long) mBeanServer.getAttribute(connectorName, <span class="string">&quot;requestCount&quot;</span>));</span><br><span class="line">            stats.setErrorCount((Long) mBeanServer.getAttribute(connectorName, <span class="string">&quot;errorCount&quot;</span>));</span><br><span class="line">            stats.setBytesReceived((Long) mBeanServer.getAttribute(connectorName, <span class="string">&quot;bytesReceived&quot;</span>));</span><br><span class="line">            stats.setBytesSent((Long) mBeanServer.getAttribute(connectorName, <span class="string">&quot;bytesSent&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> stats;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;获取Tomcat统计信息失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TomcatStats</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> currentThreadCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> currentThreadsBusy;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> maxThreads;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> requestCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> errorCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> bytesReceived;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> bytesSent;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBusyPercentage</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> maxThreads &gt; <span class="number">0</span> ? (<span class="type">double</span>) currentThreadsBusy / maxThreads * <span class="number">100</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getErrorRate</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> requestCount &gt; <span class="number">0</span> ? (<span class="type">double</span>) errorCount / requestCount * <span class="number">100</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="7-集群配置高可用部署方案">7. 集群配置：高可用部署方案</span></h2><h3><span id="71-会话复制配置">7.1 会话复制配置</span></h3><p>小wic讲解集群部署：”集群配置可以实现应用的高可用性。”</p>
<p><strong>会话复制配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 集群配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Cluster</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">channelSendOptions</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 管理器配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">expireSessionsOnShutdown</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">notifyListenersOnReplication</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 通道配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Channel</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.group.GroupChannel&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 成员配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Membership</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.membership.McastService&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">address</span>=<span class="string">&quot;228.0.0.4&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">port</span>=<span class="string">&quot;45564&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">frequency</span>=<span class="string">&quot;500&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">dropTime</span>=<span class="string">&quot;3000&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 接收器配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Receiver</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.transport.nio.NioReceiver&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">address</span>=<span class="string">&quot;auto&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">port</span>=<span class="string">&quot;4000&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">autoBind</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">selectorTimeout</span>=<span class="string">&quot;5000&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">maxThreads</span>=<span class="string">&quot;6&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 发送器配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Sender</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.transport.ReplicationTransmitter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Transport</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.transport.nio.PooledParallelSender&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Sender</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 拦截器配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Interceptor</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.group.interceptors.TcpFailureDetector&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Interceptor</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Channel</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 阀门配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">filter</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.ha.session.JvmRouteBinderValve&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 部署器配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Deployer</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">tempDir</span>=<span class="string">&quot;/tmp/war-temp/&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">deployDir</span>=<span class="string">&quot;/tmp/war-deploy/&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">watchDir</span>=<span class="string">&quot;/tmp/war-listen/&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">watchEnabled</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Cluster</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="72-负载均衡配置">7.2 负载均衡配置</span></h3><p>小wic讲解负载均衡：”负载均衡可以将请求分发到多个Tomcat实例。”</p>
<p><strong>Nginx负载均衡配置</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx.conf</span></span><br><span class="line"><span class="section">upstream</span> tomcat_cluster &#123;</span><br><span class="line">    <span class="comment"># 负载均衡策略</span></span><br><span class="line">    least_conn;  <span class="comment"># 最少连接策略</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Tomcat服务器列表</span></span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.101:8080</span> weight=<span class="number">3</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.102:8080</span> weight=<span class="number">2</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.1.103:8080</span> weight=<span class="number">1</span> max_fails=<span class="number">3</span> fail_timeout=<span class="number">30s</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 会话保持</span></span><br><span class="line">    <span class="attribute">sticky</span> cookie srv_id expires=<span class="number">1h</span> domain=.example.com path=/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> employee.example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 静态资源处理</span></span><br><span class="line">    <span class="section">location</span> <span class="regexp">~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$</span> &#123;</span><br><span class="line">        <span class="attribute">expires</span> <span class="number">1y</span>;</span><br><span class="line">        <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public, immutable&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试本地文件，不存在则代理到Tomcat</span></span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">@tomcat</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 动态请求代理</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://tomcat_cluster;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 代理头部设置</span></span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 超时设置</span></span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">30s</span>;</span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">30s</span>;</span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">30s</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 缓冲区设置</span></span><br><span class="line">        <span class="attribute">proxy_buffering</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>;</span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">8</span> <span class="number">4k</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 错误处理</span></span><br><span class="line">        <span class="attribute">proxy_next_upstream</span> <span class="literal">error</span> timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">        <span class="attribute">proxy_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Tomcat代理位置</span></span><br><span class="line">    <span class="section">location</span> <span class="variable">@tomcat</span> &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://tomcat_cluster;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3><span id="73-健康检查配置">7.3 健康检查配置</span></h3><p>小wic讲解健康检查：”健康检查确保只有健康的实例接收请求。”</p>
<p><strong>健康检查端点</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheManager cacheManager;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/health&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;HealthResponse&gt; <span class="title function_">healthCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HealthResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HealthResponse</span>();</span><br><span class="line">        response.setStatus(<span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        response.setTimestamp(System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查数据库连接</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;database&quot;</span>, <span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">            response.setStatus(<span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查缓存</span></span><br><span class="line">        <span class="keyword">if</span> (cacheManager != <span class="literal">null</span>) &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;cache&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;cache&quot;</span>, <span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">            response.setStatus(<span class="string">&quot;DOWN&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查磁盘空间</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">disk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">freeSpace</span> <span class="operator">=</span> disk.getFreeSpace();</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalSpace</span> <span class="operator">=</span> disk.getTotalSpace();</span><br><span class="line">        <span class="type">double</span> <span class="variable">freePercentage</span> <span class="operator">=</span> (<span class="type">double</span>) freeSpace / totalSpace * <span class="number">100</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (freePercentage &gt; <span class="number">10</span>) &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;disk&quot;</span>, <span class="string">&quot;UP&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.getComponents().put(<span class="string">&quot;disk&quot;</span>, <span class="string">&quot;LOW&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> <span class="string">&quot;UP&quot;</span>.equals(response.getStatus()) ? HttpStatus.OK : HttpStatus.SERVICE_UNAVAILABLE;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(response, status);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HealthResponse</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String status;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> timestamp;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, String&gt; components = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>健康检查脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># health-check.sh</span></span><br><span class="line"></span><br><span class="line">APP_URL=<span class="string">&quot;http://localhost:8080/employee/health&quot;</span></span><br><span class="line">MAX_RETRIES=3</span><br><span class="line">RETRY_INTERVAL=5</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">seq</span> 1 <span class="variable">$MAX_RETRIES</span>); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;健康检查尝试 <span class="variable">$i</span>/<span class="variable">$MAX_RETRIES</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    response=$(curl -s -o /dev/null -w <span class="string">&quot;%&#123;http_code&#125;&quot;</span> <span class="string">&quot;<span class="variable">$APP_URL</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$response</span>&quot;</span> -eq 200 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;应用健康检查通过&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;健康检查失败，状态码: <span class="variable">$response</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$i</span> -lt <span class="variable">$MAX_RETRIES</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;等待 <span class="variable">$RETRY_INTERVAL</span> 秒后重试...&quot;</span></span><br><span class="line">            <span class="built_in">sleep</span> <span class="variable">$RETRY_INTERVAL</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;健康检查失败，应用可能不可用&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="8-实战演练员工管理系统的生产部署">8. 实战演练：员工管理系统的生产部署</span></h2><h3><span id="81-部署环境准备">8.1 部署环境准备</span></h3><p>小wic指导张子烨和小温进行生产部署：”现在让我们将员工管理系统部署到生产环境。”</p>
<p><strong>环境检查脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># env-check.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 生产环境检查 ===&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Java版本</span></span><br><span class="line">java -version 2&gt;&amp;1 | grep <span class="string">&quot;version&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Tomcat目录</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$CATALINA_HOME</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Tomcat目录存在: <span class="variable">$CATALINA_HOME</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;错误: Tomcat目录不存在&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查端口占用</span></span><br><span class="line">netstat -tulpn | grep :8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查磁盘空间</span></span><br><span class="line"><span class="built_in">df</span> -h /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查内存使用</span></span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 环境检查完成 ===&quot;</span></span><br></pre></td></tr></table></figure>

<h3><span id="82-应用打包与部署">8.2 应用打包与部署</span></h3><p><strong>Maven打包配置</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml中的打包配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>employee-management<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Maven编译插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- WAR打包插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">webResources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.html<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.css<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.js<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 资源过滤插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 资源过滤 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>部署脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># deploy.sh</span></span><br><span class="line"></span><br><span class="line">APP_NAME=<span class="string">&quot;employee-management&quot;</span></span><br><span class="line">WAR_FILE=<span class="string">&quot;target/<span class="variable">$APP_NAME</span>.war&quot;</span></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup/<span class="subst">$(date +%Y%m%d_%H%M%S)</span>&quot;</span></span><br><span class="line">TOMCAT_WEBAPPS=<span class="string">&quot;/opt/tomcat/webapps&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;开始部署 <span class="variable">$APP_NAME</span>...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 停止Tomcat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;停止Tomcat...&quot;</span></span><br><span class="line">/opt/tomcat/bin/shutdown.sh</span><br><span class="line"><span class="built_in">sleep</span> 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 备份原有应用</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$TOMCAT_WEBAPPS</span>/<span class="variable">$APP_NAME</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;备份原有应用...&quot;</span></span><br><span class="line">    <span class="built_in">cp</span> -r <span class="string">&quot;<span class="variable">$TOMCAT_WEBAPPS</span>/<span class="variable">$APP_NAME</span>&quot;</span> <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/&quot;</span></span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$TOMCAT_WEBAPPS</span>/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line">    <span class="built_in">rm</span> -f <span class="string">&quot;<span class="variable">$TOMCAT_WEBAPPS</span>/<span class="variable">$APP_NAME</span>.war&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 清理工作目录</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;/opt/tomcat/work/Catalina/localhost/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 部署新应用</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;部署新应用...&quot;</span></span><br><span class="line"><span class="built_in">cp</span> <span class="string">&quot;<span class="variable">$WAR_FILE</span>&quot;</span> <span class="string">&quot;<span class="variable">$TOMCAT_WEBAPPS</span>/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 启动Tomcat</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;启动Tomcat...&quot;</span></span><br><span class="line">/opt/tomcat/bin/startup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 等待应用启动</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;等待应用启动...&quot;</span></span><br><span class="line"><span class="built_in">sleep</span> 30</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 验证部署</span></span><br><span class="line"><span class="keyword">if</span> curl -s http://localhost:8080/<span class="variable">$APP_NAME</span>/health | grep -q <span class="string">&#x27;&quot;status&quot;:&quot;UP&quot;&#x27;</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;部署成功!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;应用地址: http://localhost:8080/<span class="variable">$APP_NAME</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;部署失败，请检查日志&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3><span id="83-部署验证">8.3 部署验证</span></h3><p><strong>部署验证脚本</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeploymentValidator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(DeploymentValidator.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validateDeployment</span><span class="params">(ContextRefreshedEvent event)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;开始验证部署...&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证数据库连接</span></span><br><span class="line">        validateDatabase();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证缓存服务</span></span><br><span class="line">        validateCache();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证外部服务</span></span><br><span class="line">        validateExternalServices();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证文件权限</span></span><br><span class="line">        validateFilePermissions();</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;部署验证完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateDatabase</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> ApplicationContextHolder.getBean(DataSource.class);</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 执行简单查询验证</span></span><br><span class="line">            <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT 1&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;数据库连接验证通过&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            rs.close();</span><br><span class="line">            stmt.close();</span><br><span class="line">            conn.close();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;数据库连接验证失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;数据库连接异常&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> ApplicationContextHolder.getBean(CacheManager.class);</span><br><span class="line">            <span class="keyword">if</span> (cacheManager != <span class="literal">null</span>) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;缓存服务验证通过&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;缓存服务验证失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateExternalServices</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 验证邮件服务、文件服务等外部依赖</span></span><br><span class="line">        logger.info(<span class="string">&quot;外部服务验证通过&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">validateFilePermissions</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/opt/apps/employee-management/uploads&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!uploadDir.exists()) &#123;</span><br><span class="line">            uploadDir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (uploadDir.canWrite()) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;文件权限验证通过&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;文件权限验证失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2><span id="9-危机化解部署故障的排查与解决">9. 危机化解：部署故障的排查与解决</span></h2><h3><span id="91-常见部署问题">9.1 常见部署问题</span></h3><p>小wic讲解部署过程中可能遇到的问题：”部署过程中经常会遇到各种问题，我们需要学会快速排查。”</p>
<p><strong>问题排查脚本</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># troubleshoot.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Tomcat部署问题排查 ===&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 检查Tomcat进程</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. 检查Tomcat进程:&quot;</span></span><br><span class="line">ps aux | grep tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 检查端口占用</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. 检查端口占用:&quot;</span></span><br><span class="line">netstat -tulpn | grep :8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 检查日志文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. 检查最新日志:&quot;</span></span><br><span class="line"><span class="built_in">tail</span> -50 /opt/tomcat/logs/catalina.out</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 检查应用目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. 检查应用目录:&quot;</span></span><br><span class="line"><span class="built_in">ls</span> -la /opt/tomcat/webapps/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 检查文件权限</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. 检查文件权限:&quot;</span></span><br><span class="line"><span class="built_in">ls</span> -la /opt/tomcat/webapps/employee-management/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 检查JVM内存</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;6. 检查JVM内存:&quot;</span></span><br><span class="line">jstat -gc $(pgrep java) 1s 5</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 排查完成 ===&quot;</span></span><br></pre></td></tr></table></figure>

<h3><span id="92-性能瓶颈突破">9.2 性能瓶颈突破</span></h3><p>张子烨发现部署后系统响应变慢，小wic指导他们进行性能优化。</p>
<p><strong>性能监控脚本</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/performance/metrics&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PerformanceMetrics <span class="title function_">getPerformanceMetrics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PerformanceMetrics</span> <span class="variable">metrics</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PerformanceMetrics</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取系统指标</span></span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        metrics.setTotalMemory(runtime.totalMemory());</span><br><span class="line">        metrics.setFreeMemory(runtime.freeMemory());</span><br><span class="line">        metrics.setMaxMemory(runtime.maxMemory());</span><br><span class="line">        metrics.setAvailableProcessors(runtime.availableProcessors());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取线程信息</span></span><br><span class="line">        <span class="type">ThreadMXBean</span> <span class="variable">threadMXBean</span> <span class="operator">=</span> ManagementFactory.getThreadMXBean();</span><br><span class="line">        metrics.setThreadCount(threadMXBean.getThreadCount());</span><br><span class="line">        metrics.setPeakThreadCount(threadMXBean.getPeakThreadCount());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取GC信息</span></span><br><span class="line">        List&lt;GarbageCollectorMXBean&gt; gcBeans = ManagementFactory.getGarbageCollectorMXBeans();</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalGcCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalGcTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (GarbageCollectorMXBean gcBean : gcBeans) &#123;</span><br><span class="line">            totalGcCount += gcBean.getCollectionCount();</span><br><span class="line">            totalGcTime += gcBean.getCollectionTime();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        metrics.setGcCount(totalGcCount);</span><br><span class="line">        metrics.setGcTime(totalGcTime);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> metrics;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PerformanceMetrics</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> totalMemory;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> freeMemory;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> maxMemory;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> availableProcessors;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> threadCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> peakThreadCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> gcCount;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">long</span> gcTime;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getMemoryUsage</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">double</span>) (totalMemory - freeMemory) / totalMemory * <span class="number">100</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getMemoryUsagePercentage</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">double</span>) (totalMemory - freeMemory) / maxMemory * <span class="number">100</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优化成果</strong>：<br>经过性能优化后，系统响应时间从原来的2秒降低到200毫秒，并发处理能力提升了5倍。</p>
<hr>
<h2><span id="10-技术要点总结">10. 技术要点总结</span></h2><h3><span id="101-tomcat核心概念">10.1 Tomcat核心概念</span></h3><p>小wic总结Tomcat的核心知识点：</p>
<ol>
<li><strong>容器架构</strong>：理解Server、Service、Engine、Host、Context的层次关系</li>
<li><strong>连接器配置</strong>：掌握HTTP和AJP连接器的配置和优化</li>
<li><strong>部署方式</strong>：熟悉自动部署、手动部署、热部署的区别和应用场景</li>
<li><strong>性能优化</strong>：掌握JVM参数、连接器参数、会话管理的优化策略</li>
<li><strong>安全管理</strong>：了解用户认证、SSL配置、安全头部的设置方法</li>
<li><strong>监控运维</strong>：掌握日志配置、JMX监控、健康检查的实现方式</li>
<li><strong>集群部署</strong>：理解会话复制、负载均衡、高可用方案的配置</li>
</ol>
<h3><span id="102-最佳实践">10.2 最佳实践</span></h3><p><strong>部署最佳实践</strong>：</p>
<ul>
<li>使用版本控制管理配置文件</li>
<li>实现自动化部署流程</li>
<li>配置完善的监控告警</li>
<li>定期进行性能测试和优化</li>
<li>建立回滚机制应对部署失败</li>
</ul>
<p><strong>安全最佳实践</strong>：</p>
<ul>
<li>定期更新Tomcat版本</li>
<li>配置严格的访问控制</li>
<li>启用HTTPS加密传输</li>
<li>设置安全响应头部</li>
<li>定期进行安全扫描</li>
</ul>
<hr>
<h2><span id="11-成长收获">11. 成长收获</span></h2><h3><span id="111-技术能力提升">11.1 技术能力提升</span></h3><p>张子烨和小温通过本章的学习，掌握了：</p>
<ul>
<li>Tomcat服务器的完整架构和配置方法</li>
<li>Web应用的生产环境部署流程</li>
<li>性能监控和优化技术</li>
<li>高可用集群部署方案</li>
<li>安全防护和运维管理</li>
</ul>
<h3><span id="112-问题解决能力">11.2 问题解决能力</span></h3><p>他们学会了：</p>
<ul>
<li>快速定位和解决部署问题</li>
<li>性能瓶颈的分析和优化</li>
<li>生产环境的故障排查</li>
<li>团队协作的部署流程</li>
</ul>
<hr>
<h2><span id="12-下章预告">12. 下章预告</span></h2><p>小wic宣布下一章的内容：”下一章我们将进入第二卷’项目实战 - 迪克商城后台系统’，开始真正的企业级项目开发。你们将学习SpringBoot框架的核心特性，构建一个完整的电商后台系统。”</p>
<hr>
<h2><span id="13-本章总结">13. 本章总结</span></h2><p>第20章《Tomcat服务器：Web应用的运行容器》完整介绍了Tomcat服务器的各个方面。从基础概念到高级配置，从单机部署到集群方案，张子烨和小温系统掌握了Web应用的生产环境部署技术。</p>
<p>通过本章的学习，他们不仅解决了员工管理系统的部署问题，更重要的是建立了完整的生产环境运维思维。这为他们后续的企业级项目开发奠定了坚实的基础。</p>
<p><strong>本章特色亮点</strong>：</p>
<ul>
<li><strong>完整的技术体系</strong>：覆盖Tomcat配置、部署、优化、监控全流程</li>
<li><strong>实战导向</strong>：通过员工管理系统的实际部署案例讲解</li>
<li><strong>问题解决</strong>：包含常见部署问题的排查和解决方法</li>
<li><strong>最佳实践</strong>：总结生产环境部署的最佳实践</li>
<li><strong>技术深度</strong>：从基础到高级，层层递进的技术讲解</li>
</ul>
<p>随着Web开发入门阶段的完成，张子烨和小温即将进入更具挑战性的项目实战阶段，开启新的技术征程。<br>&#96;&#96;&#96;</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">potoior</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/10/01/%E7%AC%AC20%E7%AB%A0%EF%BC%9ATomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9AWeb%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8/">http://example.com/2025/10/01/%E7%AC%AC20%E7%AB%A0%EF%BC%9ATomcat%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9AWeb%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">potoior</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/01/%E7%AC%AC21%E7%AB%A0%EF%BC%9A%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90/" title="代码神域：第21章：员工信息管理模块需求分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">代码神域：第21章：员工信息管理模块需求分析</div></div><div class="info-2"><div class="info-item-1">第21章：员工信息管理模块需求分析章节概述字数统计：约12,800字 故事场景：需求分析会议室、业务流程图绘制室、用户访谈现场、技术规划室 核心冲突：业务需求模糊不清 vs 技术实现精确要求 技术要点：需求分析方法论、业务流程图绘制、功能点拆分、技术方案设计 开篇：第一个实战项目的挑战清晨的阳光透过迪克科技会议室的大玻璃窗，洒在张子烨略显紧张的脸上。他面前摆放着一份厚厚的项目需求文档，标题赫然写着”员工信息管理模块开发需求”。 “子烨，这是你的第一个实战项目。”李经理推了推眼镜，语气严肃，”员工信息管理看似简单，但涉及公司核心人事数据，容不得半点马虎。” 张子烨深吸一口气，脑海中浮现出代码神域中小wic的教导：”真正的技术高手，不仅会写代码，更要懂得理解业务需求。” “我准备好了，李经理。”张子烨翻开笔记本，”让我们从需求分析开始吧。” 需求分析基础：从业务到技术的桥梁需求分析的重要性在代码神域的需求分析神殿中，小wic化身为智慧长者，向张子烨传授需求分析的真谛： “需求分析是软件开发的第一步，也是最关键的一步。”小wic的声音在神殿中回荡，”一个成功的项目，70%取决于需求分析...</div></div></div></a><a class="pagination-related" href="/2025/10/01/%E7%AC%AC19%E7%AB%A0%EF%BC%9AHTTP%E5%8D%8F%E8%AE%AE%EF%BC%9AWeb%E4%B8%96%E7%95%8C%E7%9A%84%E9%80%9A%E7%94%A8%E8%AF%AD%E8%A8%80/" title="代码神域：第19章：HTTP协议：Web世界的通用语言"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">代码神域：第19章：HTTP协议：Web世界的通用语言</div></div><div class="info-2"><div class="info-item-1">第19章：HTTP协议：Web世界的通用语言章节概述字数统计：13,800字核心场景：网络通信殿堂、协议翻译室、数据包河流技术冲突：通信混乱、协议理解不足、性能瓶颈成长主题：从表面请求到深层协议理解的思维转变  开篇：通信的迷雾张子烨和小温成功应用MVC模式重构了员工管理系统，系统运行稳定，界面清晰。然而，在一次与外部系统对接时，他们遇到了新的挑战。 “子烨，你看这个API调用，”小温指着监控日志，”响应时间超过了5秒，用户体验很差。” 张子烨查看日志，发现HTTP请求的细节：”这个请求头很大，而且没有使用压缩。我们需要深入理解HTTP协议才能优化性能。” 就在这时，代码神域的通信殿堂缓缓打开，小wic的声音在耳边响起：”年轻的程序员们，你们已经触及了Web通信的核心。现在，让我们进入HTTP协议的殿堂，学习Web世界的通用语言。”  1. HTTP基础：通信协议的基石1.1 什么是HTTP协议？在代码神域的通信殿堂中，小wic带着张子烨和小温来到一面巨大的协议墙前。墙上展示着HTTP协议的完整结构。 “HTTP，全称HyperText Transfer Protocol，是We...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">potoior</div><div class="author-info-description">一位半栈工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">136</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/potoior"><i class="fab fa-github"></i><span>出发咯</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/potoior" target="_blank" title=""><i class="GitHub"></i></a><a class="social-icon" href="mailto:2986486901@qq.com" target="_blank" title=""><i class="Email"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">第20章：Tomcat服务器：Web应用的运行容器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">章节概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">开篇：部署的挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">1. Tomcat基础：Web应用的容器引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">1.1 什么是Tomcat？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">1.2 Tomcat目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">1.3 Tomcat启动流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">2. 配置文件详解：Tomcat的核心设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.1 server.xml配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.2 web.xml配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">2.3 context.xml配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">3. 部署方式：Web应用的发布策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.1 自动部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.2 手动部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">3.3 热部署与热加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">4. 性能优化：Tomcat的高效运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">4.1 连接器优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">4.2 JVM参数优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">4.3 会话管理优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">5. 安全管理：Tomcat的安全防护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">5.1 用户认证与授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">5.2 SSL&#x2F;TLS配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">5.3 安全头部配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">6. 监控与日志：Tomcat的运行状态跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.1 访问日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.2 应用日志配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">6.3 JMX监控配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">7. 集群配置：高可用部署方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">7.1 会话复制配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">7.2 负载均衡配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">7.3 健康检查配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">8. 实战演练：员工管理系统的生产部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">8.1 部署环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">8.2 应用打包与部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">8.3 部署验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">9. 危机化解：部署故障的排查与解决</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">9.1 常见部署问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">9.2 性能瓶颈突破</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">10. 技术要点总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">10.1 Tomcat核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">10.2 最佳实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">11. 成长收获</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">11.1 技术能力提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text">11.2 问题解决能力</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">12. 下章预告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">13. 本章总结</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By potoior</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>